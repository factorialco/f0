# F0 React Native üé®

React Native implementation of the F0 Design System.

## üöÄ Quick Setup

### 1Ô∏è‚É£ Install Dependencies

```bash
# Install package and peer dependencies
pnpm add @factorialco/f0-react-native \
  date-fns@^3.6.0 \
  react-native-reanimated@^3.19.4 \
  react-native-safe-area-context@^5.4.0 \
  react-native-svg@^15.12.1 \
  react-native-worklets-core@^1.6.2 \
  tailwind-merge@^3.4.0 \
  tailwind-variants@^3.2.2 \
  tailwindcss@^4.1.18 \
  uniwind@^1.2.7 \
  twemoji-parser@^14.0.0
```

> **Note:** The following peer dependencies are required:
> - `uniwind` and `tailwindcss` - Required for styling (must be configured in Metro and CSS files)
> - `tailwind-merge` and `tailwind-variants` - Required for component variant system and class merging
> - `react-native-reanimated` - Required for animations
> - `react-native-safe-area-context` - Required for safe area handling
> - `react-native-svg` - Required for icon components
> - `date-fns` - Required for date utilities
> - `twemoji-parser` - Required for emoji support
> 
> `react-native-worklets-core` is optional but recommended for better performance.

### 2Ô∏è‚É£ Configure Babel

**`babel.config.js`:**

```javascript
module.exports = function (api) {
  api.cache(true);
  return {
    presets: ["babel-preset-expo"], // Expo only
    plugins: [
      "react-native-worklets-core/plugin",
      "react-native-reanimated/plugin", // MUST be last
    ],
  };
};
```

> **Note:** Uniwind doesn't require special Babel configuration. The above is a standard Expo setup.

### 3Ô∏è‚É£ Configure Metro

**`metro.config.js`:**

```javascript
const { getDefaultConfig } = require("expo/metro-config");
const { withUniwindConfig } = require("uniwind/metro");

const config = getDefaultConfig(__dirname);

// Ensure CSS files trigger reloads
config.resolver.sourceExts = [...(config.resolver.sourceExts || []), "css"];

module.exports = withUniwindConfig(config, {
  cssEntryFile: "./global.css",
  dtsFile: "./uniwind-types.d.ts",
});
```

### 4Ô∏è‚É£ Create Global CSS

**`global.css` (root):**

```css
@import 'tailwindcss';
@import 'uniwind';

/* Import F0 theme tokens */
@import '@factorialco/f0-react-native/theme.css';

/* ‚úÖ RECOMMENDED: Import F0 component classes using @source inline() */
/* This works reliably with Tailwind CSS v4, pnpm, and node_modules */
@import '@factorialco/f0-react-native/classes.css';

/* Add your app's source paths for Tailwind CSS v4 */
@source "./app/**/*.{js,jsx,ts,tsx}";
@source "./src/**/*.{js,jsx,ts,tsx}";
```

**Import in your entry file (`App.tsx` or `index.js`):**

```typescript
import "./global.css";
```

> **‚ö†Ô∏è Important:** Tailwind CSS v4 has known limitations scanning `node_modules` (GitHub #19040), especially with pnpm. 
> 
> **‚úÖ Solution:** The package exports `classes.css` which uses `@source inline()` to force Tailwind to include all F0 component classes. This works reliably across all package managers and doesn't require scanning `node_modules`.
> 
> **Why `classes.css` instead of `@source` paths?**
> - `@source` with file paths doesn't reliably scan `node_modules` in Tailwind v4
> - `@source inline()` explicitly tells Tailwind which classes to include
> - Works with pnpm, npm, and yarn
> - No performance impact from scanning entire `node_modules`
> 
> The F0 theme tokens are imported from `@factorialco/f0-react-native/theme.css`.

### 5Ô∏è‚É£ TypeScript Support (Optional)

**`uniwind-types.d.ts` (root):**

```typescript
/// <reference types="uniwind/types" />
```

This file is automatically generated by Uniwind when you run Metro. You can add it to your `.gitignore` if desired.

## üì¶ Usage

### Basic Component Usage

```tsx
import { Button, Icon, AppIcons } from "@factorialco/f0-react-native";

export default function App() {
  return (
    <>
      <Button label="Click me" variant="default" size="md" />
      <Icon icon={AppIcons.Calendar} size="md" />
    </>
  );
}
```

### Using the `cn` Utility

The package exports a `cn` utility function for merging Tailwind classes with automatic conflict resolution:

```tsx
import { cn } from "@factorialco/f0-react-native";
import { View } from "react-native";

function MyComponent({ className, isActive }) {
  return (
    <View
      className={cn(
        'bg-background p-4 rounded-lg',
        'border border-divider',
        isActive && 'bg-accent',
        className
      )}
    />
  );
}
```

The `cn` utility:
- ‚úÖ Automatically merges Tailwind classes with conflict resolution
- ‚úÖ Uses `tailwind-merge` under the hood
- ‚úÖ Supports custom opacity class groups
- ‚úÖ Properly handles conditional classes

### Component Variants

All components use `tailwind-variants` for type-safe variant props:

```tsx
import { Button } from "@factorialco/f0-react-native";

// Type-safe variants
<Button 
  label="Primary Button"
  variant="default"  // ‚úÖ Autocomplete: "default" | "outline" | "critical" | "neutral" | "ghost" | "promote"
  size="md"          // ‚úÖ Autocomplete: "sm" | "md" | "lg"
/>
```

## üîß Troubleshooting

### Classes Not Being Detected by Uniwind

If styles from F0 components aren't being applied, ensure:

1. **Import classes.css:** Your `global.css` includes the F0 classes CSS file:
   ```css
   @import '@factorialco/f0-react-native/classes.css';
   ```
   This works reliably with Tailwind CSS v4, pnpm, npm, and yarn.

2. **Metro Cache:** Clear Metro bundler cache:
   ```bash
   npx expo start --clear
   # or
   npm start -- --reset-cache
   ```

3. **Dependencies:** Verify all peer dependencies are installed:
   ```bash
   pnpm list tailwind-merge tailwind-variants tailwindcss uniwind
   ```

4. **Classes File:** Ensure the classes file exists (it's auto-generated during build):
   ```bash
   # Check if file exists
   ls node_modules/@factorialco/f0-react-native/src/styles/classes.css
   
   # If missing, the package may need to be rebuilt
   ```

### TypeScript Errors with Variants

If you see TypeScript errors related to variants, ensure `tailwind-variants` is installed:

```bash
pnpm add tailwind-variants@^3.2.2
```

### Build Errors

If you encounter build errors, ensure:
- All peer dependencies are installed
- Metro config includes CSS file extensions
- Babel plugins are properly configured

## üîß Development

```bash
# Run tests
pnpm test

# Type check
pnpm tsc

# Lint
pnpm lint

# Build package
pnpm build

# Generate classes.css file
pnpm run generate-classes

# Verify classes.css is valid
pnpm run verify-classes

# Test classes.css export (simulates external consumer)
pnpm run test-classes

# Test classes.css mode in playground (temporarily switch to classes.css)
pnpm run test-classes-mode enable   # Switch to classes.css mode
# ... test your app ...
pnpm run test-classes-mode disable  # Restore normal mode
```

## üìö Documentation

For detailed installation guide, see [docs/INSTALLATION.md](./docs/INSTALLATION.md).

For styling best practices and improvements, see [improvements.md](./improvements.md).

## üé® Classes Export

The package automatically exports all Tailwind classes used in components via `./classes.css` using Tailwind's `@source inline()` directive. This ensures Uniwind/Tailwind CSS v4 can detect all component classes without scanning `node_modules`.

### Usage

**In your `global.css`:**

```css
@import '@factorialco/f0-react-native/classes.css';
```

**Why this works:**
- ‚úÖ Works reliably with Tailwind CSS v4 (fixes GitHub #19040)
- ‚úÖ Works with pnpm, npm, and yarn
- ‚úÖ Uses `@source inline()` which explicitly tells Tailwind which classes to include
- ‚úÖ No dependency on `node_modules` scanning (which is unreliable in Tailwind v4)
- ‚úÖ No performance impact from scanning entire `node_modules` directory

### Internal Development / Showcase

If you're developing within the same workspace (like the internal playground/showcase), you **don't need** `classes.css`. You can scan `src/` directly:

```css
@source "./src/**/*.{js,jsx,ts,tsx}";
```

**Why this works internally:**
- Files are in local paths, not `node_modules`
- Tailwind can scan local directories reliably
- No need for `@source inline()` workaround

**When to use `classes.css`:**
- ‚úÖ External consumers installing from npm
- ‚úÖ Projects where `node_modules` scanning fails
- ‚úÖ When using pnpm with symlinks
- ‚ùå **NOT needed** for internal monorepo development

### How It Works

The `classes.css` file is auto-generated during the build process and contains all unique Tailwind classes extracted from:
- `tv()` calls in component variants
- `className` props in components
- All variant combinations

It uses Tailwind's `@source inline()` directive to explicitly include all classes, bypassing the unreliable `node_modules` scanning that affects Tailwind CSS v4.

### Testing the Classes Export

To verify that the classes export works correctly:

```bash
# 1. Generate/verify classes files
pnpm run generate-classes
pnpm run verify-classes

# 2. Test classes.css mode in playground
pnpm run test-classes-mode enable   # Switches to using classes.css
# ... run your app and verify components work ...
pnpm run test-classes-mode disable  # Restores normal src/ scanning
```

### Known Issues with Tailwind CSS v4

Tailwind CSS v4 has known limitations scanning `node_modules`:
- **GitHub Issue #19040**: `@source` doesn't reliably scan `node_modules` packages
- **GitHub Issue #16038**: Additional issues with pnpm and symlinks
- **Solution**: Use `@source inline()` via `classes.css` (implemented in this package)

## üì¶ Peer Dependencies

This package requires the following peer dependencies to be installed in your host project:

| Package | Version | Required | Purpose |
|---------|---------|----------|---------|
| `react` | `*` | ‚úÖ Yes | React library |
| `react-native` | `*` | ‚úÖ Yes | React Native framework |
| `tailwindcss` | `^4.1.18` | ‚úÖ Yes | CSS framework |
| `uniwind` | `^1.2.7` | ‚úÖ Yes | Tailwind CSS for React Native |
| `tailwind-merge` | `^3.4.0` | ‚úÖ Yes | Class merging utility |
| `tailwind-variants` | `^3.2.2` | ‚úÖ Yes | Variant system |
| `react-native-reanimated` | `^3.19.4` | ‚úÖ Yes | Animations |
| `react-native-safe-area-context` | `^5.4.0` | ‚úÖ Yes | Safe area handling |
| `react-native-svg` | `^15.12.1` | ‚úÖ Yes | SVG support for icons |
| `date-fns` | `^3.6.0` | ‚úÖ Yes | Date utilities |
| `twemoji-parser` | `^14.0.0` | ‚úÖ Yes | Emoji support |
| `react-native-worklets-core` | `^1.6.2` | ‚ö†Ô∏è Optional | Performance optimization |

## üìÑ License

MIT
