import { Canvas, Meta, Controls, Unstyled } from "@storybook/blocks"
import { DoDonts } from "@/lib/storybook-utils/do-donts"

import * as DataCollectionStories from "./index.stories"
import * as ActionDataCollectionStories from "./collection-actions.stories"

<Meta title="Data collection" />

# Data collection

## Introduction

### Definition

The Data Collection component is designed to standardize and optimize the
visualization and manipulation of data across the platform. It provides a more
intuitive, flexible experience that supports different ways to view data,
primarily through table, card, and list formats.

### Purpose

- **Unify the data experience:** Create a consistent and predictable experience
  for users when interacting with data across the application.
- **Simplify complexity:** Automatically manage the technical aspects of data
  presentation, allowing users to focus on the information.
- **Improve efficiency:** Enable quick analysis and optimize workflows with
  filtering, sorting, contextual visualization, and bulk actions.
- **Scale with data:** Maintain performance and usability with both small
  datasets and large volumes of information.

### View modes

Data Collection offers three main data visualization modes, each optimized for
different contexts and needs:

1. **Table View:** The default view that organizes data into rows and columns.
   Ideal for visualizing and comparing multiple data attributes simultaneously.
2. **Cards View:** Provides a more visual and content-oriented layout with
   greater emphasis on visuals. Optimized for datasets where resources need to
   stand out and visual elements are important.
3. **List View:** Offers a simplified visualization, displaying data in a
   vertical list format. Useful when prioritizing readability in simpler
   datasets.

<Canvas
  of={DataCollectionStories.BasicTableView}
  meta={DataCollectionStories}
/>

## Anatomy

#### Data types

Data Collection supports various data types, each with an optimized
visualization designed for specific use cases. These visualizations fall into
several categories:

- **Text-based:** Simple text presentations like labels, which can be enhanced
  with icons or formatting for different contexts.
- **Identity**: Visual representations for entities such as people, companies,
  and teams, typically using avatars with initials or images.
- **Metadata**: Specialized formats for information like dates, documents, and
  currency values.
- **Status**: Visual indicators showing state, alerts, etc.
- **Collections**: Compact visualizations for multiple related items, such as
  team members or tags.
- **Data Visualization**: Simple charts and graphs that represent data patterns
  directly in cells.

The component is designed to be extensible, allowing new cell types to be added
as needed while maintaining consistent behavior patterns within these
categories.

### Toolbar

#### Filter

Filtering allows users to define custom filtering criteria by selecting options
from various categories through the dropdown panel.

##### Filtering Panel

It is activated by clicking on the funnel icon. Once activated, a panel is
displayed with:

- Filter categories (team, workplace, job title, etc.)
- List of options within each category
- A search field to quickly find specific options
- Selection and action buttons.
- Calendar
  - Month and year selector with navigation arrows for browsing different time
    periods
  - Weekly view with day headers (Mo, Tu, We, Th, Fr, Sa, Su)
  - Selectable days for choosing specific dates
  - Date range selector with "from" and "to" fields
  - Option to either select dates directly on the calendar or enter them
    manually

##### Chips

When a filter is applied, the system generates "chips" that:

- Accumulate from left to right at the bottom of the presets and filtering
  section
- Show the user exactly which filters are active
- Include the category name and the selected value
- Include a close icon (X) that allows the user to remove that specific filter
  with a single click
- Remain active until the user explicitly removes them.

##### Presets

The presets are predefined configurations that allow users to quickly access
frequently used filtered data views. This simplifies navigation, as there is no
need to manually adjust the filters every time you want to change the table
view.

To ensure an optimal user experience, it is recommended to carefully select the
presets, prioritizing those that display the most relevant and frequently
consulted information. It is essential to avoid overloading the table with too
many preconfigured filters.

<Canvas
  of={DataCollectionStories.WithPreselectedFilters}
  meta={DataCollectionStories}
/>

#### Search

The search bar is a tool that facilitates locating data within the table. Its
main function is to allow users to find specific information quickly and
efficiently.

- **Collapsible and expandable**: The search field is hidden when not in use and
  expands when activated.
- **Real-time search**: As the user types, the results are dynamically updated.
- **Row filtering**: Only rows that match the search criteria are displayed,
  hiding those that are not relevant.

<Canvas
  of={DataCollectionStories.WithSyncSearch}
  meta={DataCollectionStories}
/>

#### Settings

The settings panel allows users to configure how data is displayed. The
component offers two main viewing options: Table view and card view.

<Canvas
  of={DataCollectionStories.WithMultipleVisualizations}
  meta={DataCollectionStories}
/>

#### Actions

Data Collection provides a hierarchy of actions for data operations:

- **Primary action**: The main action, visually emphasized, designed for the
  most common operation (such as “adding a new resource”).
- **Secondary action**: Complementary actions with less visual prominence. If
  there are multiple secondary actions, they should be grouped within the "More
  options" (ellipsis) menu, to avoid adding a second button. The goal is to
  minimize the toolbar space as much as possible to allow room for other
  elements and to avoid overwhelming the user.
- **"More options" button**: A dropdown menu containing additional actions,
  optimizing space and maintaining a clean interface.

<Canvas
  of={ActionDataCollectionStories.BasicActionsExample}
  meta={ActionDataCollectionStories}
/>

### Table view

#### Fixed columns

This feature allows specific columns (typically the identification ones) to
remain visible while horizontally scrolling through the rest of the data. It is
recommended not to fix very long columns or several consecutive columns, as this
significantly reduces the available space for viewing the table content.

<Canvas
  of={DataCollectionStories.TableFrozenCols}
  meta={DataCollectionStories}
/>

#### Sorting

Sorting in a data table allows users to organize the information in ascending or
descending order. By clicking on a column header, the data is sorted in
ascending order (A-Z or smallest to largest). A second click reverses the order
(Z-A or largest to smallest), and a third click restores the original order.

If a different column is selected, the sorting of the previous column is
canceled, and the new cycle starts from ascending order. Only one column can be
sorted at a time.

The sorting behavior depends on the data type: for text, it is sorted
alphabetically; for numbers, it is sorted from smallest to largest or vice
versa; and for dates, it is sorted chronologically.

<Canvas
  of={DataCollectionStories.WithTableVisualization}
  meta={DataCollectionStories}
/>

#### Bulk action

Bulk Actions allow users to select multiple items in a table and perform an
action on all of them simultaneously. This functionality significantly improves
user efficiency when working with large data sets, eliminating the need to
perform the same action repeatedly on individual items.

It includes several key elements:

1. **Main checkbox**: Located in the table header, it allows selecting or
   deselecting all visible items.
2. **Individual checkboxes**: Positioned in the first column of each row, they
   allow selecting specific items.
3. **Floating toolbar**: A dark bar that appears at the bottom of the screen
   when items are selected. It contains:
   - **Counter**: Displays the number of selected items.
   - **Available actions**: Buttons or dropdown menu representing the actions
     that can be performed on the selected items.
   - **Cancel button**: Allows deselecting all items and hiding the toolbar.

<Canvas
  of={DataCollectionStories.WithSelectableAndBulkActions}
  meta={DataCollectionStories}
/>

#### Row actions

The rows provide a streamlined interaction approach:

- Primary interaction is navigational - clicking a row opens the associated
  resource, side panel or modal.
- Rows do not support individual cell-level actions
- All operational actions are consolidated exclusively through the ellipsis menu
  (︙)
- The ellipsis menu provides a dropdown of available options for the selected
  row
- No other direct action buttons appear within rows themselves

<Canvas
  of={DataCollectionStories.WithLinkedItems}
  meta={DataCollectionStories}
/>

#### Loading

The component displays a visual loading state while data is being retrieved or
processed, providing the user with instant feedback on the progress of the
operation.

##### Behaviour

The loading state is automatically triggered when the component performs
asynchronous data fetching or processing operations.

During loading, each cell shows a skeleton loading indicator that maintains the
original cell dimensions.

When reloading data (through filters or pagination), the content fades out and a
spinner appears in the table.

### Pagination

The pagination automatically divides datasets into pages after reaching a
predefined number of rows, we recommend 20 items per page. This mechanism
improves performance and usability when working with large volumes of
information.

#### Behaviour

When the total number of items exceeds the page limit, the system generates
multiple navigable pages. However, when all the items fit on a single page, the
pagination interface remains visible but adopts a disabled state.

#### Pages

This is the default pagination method. It divides data into discrete pages
(e.g., 20 items per page) and provides navigation controls to jump between them.
It’s ideal for datasets where clear segmentation and predictable performance are
needed. The pagination bar remains visible even when all items fit in a single
page (but appears disabled).

<Canvas
  of={DataCollectionStories.WithPagesPagination}
  meta={DataCollectionStories}
/>

#### Infinite scroll

Infinite scroll loads additional data automatically as the user scrolls down.
This creates a continuous, fluid browsing experience without explicit page
navigation. It’s especially useful for large datasets and scenarios where the
user is expected to consume data in a linear, exploratory manner. A skeleton
loader or spinner appears near the bottom to indicate loading progress.

> Important: Infinite scroll requires the table (or main visualization wrapper)
> to be rendered inside a container with a fixed height and overflow: auto. This
> is essential to detect scroll events or trigger the intersection observer used
> for loading more data.

```tsx
<div style={{ height: '900px', overflow: 'auto' }}>
  <OneDataCollection
    source={dataSource}
    visualizations={[{ type: 'table', options: { columns: [...] } }]}
  />
</div>
```

<Canvas
  of={DataCollectionStories.WithInfiniteScrollPagination}
  meta={DataCollectionStories}
/>
