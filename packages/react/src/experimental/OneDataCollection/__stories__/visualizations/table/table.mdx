import {
  Canvas,
  Meta,
  Controls,
  Unstyled,
  Story,
} from "@storybook/addon-docs/blocks"
import LinkTo from "@storybook/addon-links/react"
import * as TableStories from "./table.stories"

<Meta title="Data Collection/Visualizations/Table" />

# Table Visualization

## Introduction

The Table visualization is a tabular visualization that displays data in rows
and columns with advanced features like column sorting, filtering, frozen
columns, column reordering, and column hiding. It provides a comprehensive view
of structured data with enhanced interactivity.

## Examples

<Canvas of={TableStories.BasicListVisualization} />

## Setting Up Table Visualization

To enable the Table visualization in your data collection component, provide the
`type: "table"` in the `visualizations` prop:

```tsx
<OneDataCollection
  source={dataSource}
  visualizations={[
    {
      type: "table",
      options: {
        columns: [
          {
            label: "Name",
            render: (item) => item.name,
            sorting: "name",
            width: 140,
          },
          {
            label: "Email",
            render: (item) => item.email,
            sorting: "email",
          },
          {
            label: "Role",
            render: (item) => item.role,
            sorting: "role",
          },
          {
            label: "Department",
            render: (item) => item.department,
            sorting: "department",
          },
        ],
      },
    },
  ]}
/>
```

## Table Properties

```ts
type TableVisualizationOptions<T> = {
  /**
   * The columns to display
   */
  columns: ReadonlyArray<TableColumnDefinition<T>>

  /**
   * The number of columns to freeze on the left
   */
  frozenColumns?: 0 | 1 | 2

  /**
   * Allow users to reorder columns (you can only reorder columns that are not frozen)
   */
  allowColumnReordering?: boolean

  /**
   * Allow users to hide columns (you can define specifically non hideable columns in col props, also frozen columns are not hideable)
   */
  allowColumnHiding?: boolean
}
```

## Table Column Definition

```ts
type TableColumnDefinition<T> = {
  /**
   * The id of the column. This is used to identify the column and is used to hide and order the columns and is required if you want to use the column hiding and ordering features.
   */
  id: string

  /**
   * The label to display for the column header.
   */
  label: string

  /**
   * The function to render the column content.
   */
  render: (item: T) => DisplayValueDefinition

  /**
   * The sorting key for this column.
   */
  sorting?: string

  /**
   * The alignment of the column. If not provided, the alignment will be "left"
   */
  align?: "left" | "right"

  /**
   * The width of the column. If not provided, the width will be "auto"
   */
  width?: number

  /**
   * The initial state of the hidden (only applies if allowColumnHiding is true)
   */
  hidden?: boolean

  /**
   * Avoid hiding the column by the user
   */
  noHiding?: boolean

  /**
   * The initial order of the column
   */
  order?: number

  /**
   * Optional summary configuration for this column
   */
  summary?: string

  /**
   * Additional information to display in the column header
   */
  info?: string

  /**
   * Icon to display next to the info text
   */
  infoIcon?: IconType
}
```

## Complete Example

```tsx
<OneDataCollection
  source={dataSource}
  visualizations={[
    {
      type: "table",
      options: {
        frozenColumns: 1,
        allowColumnReordering: true,
        allowColumnHiding: true,
        columns: [
          {
            label: "Name",
            width: 140,
            render: (item) => ({
              type: "person",
              value: {
                firstName: item.name.split(" ")[0],
                lastName: item.name.split(" ")[1],
              },
            }),
            sorting: "name",
            noHiding: true,
          },
          {
            label: "Email",
            render: (item) => item.email,
            sorting: "email",
            align: "left",
          },
          {
            label: "Role",
            render: (item) => item.role,
            sorting: "role",
            info: "User's current role in the organization",
          },
          {
            label: "Department",
            render: (item) => ({
              type: "dotTag",
              value: {
                color: "blue",
                label: item.department,
              },
            }),
            sorting: "department",
            align: "left",
          },
          {
            label: "Status",
            render: (item) => ({
              type: "status",
              value: {
                status: item.status === "active" ? "positive" : "critical",
                label:
                  item.status.charAt(0).toUpperCase() + item.status.slice(1),
              },
            }),
            sorting: "status",
            align: "center",
          },
          {
            label: "Manager",
            render: (item) => ({
              type: "person",
              value: {
                firstName: item.manager.split(" ")[0],
                lastName: item.manager.split(" ")[1],
              },
            }),
            hide: (item) => item.name.startsWith("D"),
            sorting: "manager",
          },
          {
            label: "Permissions",
            render: (item) =>
              [
                item.permissions?.read ? "Read" : "",
                item.permissions?.write ? "Write" : "",
                item.permissions?.delete ? "Delete" : "",
              ]
                .filter(Boolean)
                .join(", "),
            sorting: "permissions.read",
            align: "right",
            hidden: true, // Initially hidden
          },
        ],
      },
    },
  ]}
/>
```

## Advanced Features

### Frozen Columns

You can freeze columns to the left side of the table to keep them visible while
scrolling horizontally:

```tsx
{
  type: "table",
  options: {
    frozenColumns: 2, // Freeze first 2 columns
    columns: [
      // ... your columns
    ],
  },
}
```

<Canvas of={TableStories.TableFrozenCols} meta={TableStories} />

### Column Ordering

Using the `order` property you can define the initial order of the columns.

```tsx
{
  type: "table",
  options: {
    columns: [
      {
        label: "Role",
        render: (item) => item.role,
      },
      {
        label: "Name",
        render: (item) => item.name,
        order: 3
      },
    ],
  },
}
```

If no order is provided, the column will be placed at the end of the table.

### Column Reordering

Allow users to reorder columns by drag and drop:

```tsx
{
  type: "table",
  options: {
    allowColumnReordering: true,
    columns: [
      {
        label: "Name",
        render: (item) => item.name,
        order: 3
      },
      {
        label: "Email",
        render: (item) => item.email,
        hidden: true, // Initially hidden
        order: 1
      },

      // ... more columns
    ],
  },
}
```

### Column Hiding

Allow users to show/hide columns using column settings:

```tsx
{
  type: "table",
  options: {
    allowColumnHiding: true,
    columns: [
      {
        label: "Name",
        render: (item) => item.name,
        noHiding: true, // This column cannot be hidden
      },
      {
        label: "Email",
        render: (item) => item.email,
        hidden: true, // Initially hidden
      },
      // ... more columns
    ],
  },
}
```
