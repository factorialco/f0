import {
  Canvas,
  Meta,
  Controls,
  Unstyled,
  Story,
} from "@storybook/addon-docs/blocks"
import LinkTo from "@storybook/addon-links/react"
import * as CardStories from "./card.stories"

<Meta title="Data Collection/Visualizations/Card" />

# Card Visualization

## Introduction

The Card visualization is a visualization that displays the data in a card
format.

## Examples

<Canvas of={CardStories.BasicCardVisualization} />

## Setting Up Card Visualization

To enable the Card visualization in your data collection component, provide the
`type: "card"` in the `visualizations` prop:

```tsx
<OneDataCollection
  source={dataSource}
  visualizations={[
    {
      type: "card",
      options: {
        cardProperties: [
          { label: "Name", render: (item) => item.name },
          { label: "Email", render: (item) => item.email },
          { label: "Role", render: (item) => item.role },
          { label: "Department", render: (item) => item.department },
          { label: "Status", render: (item) => item.status },
        ],
      },
    },
  ]}
/>
```

## Card Properties

```ts
type CardVisualizationOptions<T> = {
  /**
   * The properties to display in the card.
   */
  cardProperties: CardPropertyDefinition<T>[]
  /**
   * Returns the title to display for the card.
   */
  title: (item: T) => string
  /**
   * Returns the description to display for the card.
   */
  description?: (item: T) => string
  /**
   * Returns the avatar to display for the card.
   */
  avatar?: (item: T) => CardAvatarVariant
  /**
   * Returns the header image to display for the card.
   */
  image?: (item: T) => string
  /**
   * Whether the card is displayed in a compact layout.
   */
  compact?: boolean
}
```

## Card Property Definition

```ts
type CardPropertyDefinition<T> = {
  /**
   * The label to display for the property.
   */
  label: string

  /**
   * The function to render the property.
   */
  render: (item: T) => DisplayValueDefinition
  /**
   * The icon to display for the property.
   */
  icon?: IconType
  /**
   * Allows you to hide the property for a given item.
   */
  hide?: (item: T) => boolean
}
```

## Complete Example

```tsx
<OneDataCollection
  source={dataSource}
  visualizations={[
    {
      type: "card",
      options: {
        title: (item) => item.name,
        description: (item) => item.role,
        avatar: (item) => ({
            type: "person",
            firstName: item.name.split(" ")[0],
            lastName: item.name.split(" ")[1],
        }),
        image: (item) => item.image,
        cardProperties: [
            {
                label: "Email",
                icon: Envelope,
                render: (item) => item.email,
            },
            {
                label: "Role",
                icon: Briefcase,
                render: (item) => item.role,
            },
            {
                label: "Department",
                icon: Building,
                render: (item) => item.department,
            },
            {
                label: "Manager",
                icon: Person,
                render: (item) => ({
                    type: "person",
                    value: {
                        firstName: item.manager.split(" ")[0],
                        lastName: item.manager.split(" ")[1],
                    },
                }),
                hide: (item) => item.name.startsWith("D"),
            },
            {
                label: "Teammates",
                icon: Person,
                render: (item) => ({
                    type: "avatarList",
                    value: {
                    avatarList: [
                        {
                            type: "person",
                            firstName: item.name,
                            lastName: "Doe",
                            src: "/avatars/person01.jpg",
                        },
                        {
                            type: "person",
                            firstName: "Dani",
                            lastName: "Moreno",
                            src: "/avatars/person04.jpg",
                        },
                        {
                            type: "person",
                            firstName: "Sergio",
                            lastName: "Carracedo",
                            src: "/avatars/person05.jpg",
                        },
                    ],
                    },
                }),
            },
            {
                label: "Status",
                icon: CheckCircle,
                render: (item) => ({
                    type: "status",
                    value: {
                        status: item.status === "active" ? "positive" : "critical",
                        label: item.status.charAt(0).toUpperCase() + item.status.slice(1),
                    },
                }),
            },
        ],
    },
```

## Item actions

The card visualization supports item actions. To enable item actions, provide
the `itemActions` prop to the `useDataCollectionSource` hook.

```tsx
<OneDataCollection
  source={{
    itemActions: (item) => [
      { label: "Action 1", onClick: () => console.log("Action 1"), type: "primary" },
      { label: "Action 2", onClick: () => console.log("Action 2"), type: "secondary" },
      { label: "Action 3", onClick: () => console.log("Action 3"), type: "other" },
      ...
    ],
  }}
  visualizations={[
    {
      type: "card",
      options: {
        cardProperties: [
          { label: "Name", render: (item) => item.name },
          { label: "Email", render: (item) => item.email },
          { label: "Role", render: (item) => item.role },
          { label: "Department", render: (item) => item.department },
          { label: "Status", render: (item) => item.status },
        ],
      },
    },
  ]}
/>
```

The action type will make the action to be displayed in the card dropdown menu
(other type), or in the card footer (primary type and secondary type).
