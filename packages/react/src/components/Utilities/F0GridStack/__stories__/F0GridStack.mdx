import { Canvas, Meta, Controls } from "@storybook/addon-docs/blocks"

import * as GridStackStories from "./F0GridStack.stories"

<Meta of={GridStackStories} />

# GridStack

## Introduction

### Definition

F0GridStack is a React wrapper for the GridStack library that enables the creation of resizable and
draggable grid layouts. It provides a flexible, interactive grid system where widgets can be
dynamically arranged, resized, and repositioned by users or programmatically through ref methods.

### Purpose

The purpose of F0GridStack in our design system is as follows:

- **Interactive Layouts**: Enables users to customize their dashboard or workspace layouts by
  dragging and resizing widgets
- **Dynamic Content Management**: Allows programmatic addition and removal of widgets at runtime
- **Responsive Grid System**: Provides a flexible grid that adapts to different screen sizes and
  widget configurations
- **Layout Persistence**: Supports saving and restoring widget positions and sizes through the
  onChange callback
- **Nested Grids**: Supports sub-grids for complex, hierarchical layouts

## Basic Usage

The default GridStack configuration demonstrates a simple grid layout with multiple widgets that can
be dragged and resized.

<Canvas of={GridStackStories.Default} />
<Controls of={GridStackStories.Default} />

## Programmatic Control with Ref Methods

F0GridStack exposes several methods through a ref that allow you to programmatically control the
grid layout. This is useful for dynamic widget management, such as adding or removing widgets based
on user actions or application state.

### Accessing Ref Methods

To use the ref methods, create a ref using `useRef<F0GridStackRef>(null)` and attach it to the
`F0GridStack` component:

```tsx
import { useRef } from "react"
import { F0GridStack, type F0GridStackRef } from "@/components/Utilities/F0GridStack"

const gridRef = useRef<F0GridStackRef>(null)

<F0GridStack ref={gridRef} options={{ column: 12 }} widgets={[]} />
```

### Available Methods

#### `addWidget`

Adds a new widget to the grid programmatically.

**Parameters:**

- `widget`: A `GridStackReactWidget` object with the following properties:
  - `id`: Unique identifier for the widget (required)
  - `w`: Width in grid columns
  - `h`: Height in grid rows
  - `x`: X position in grid columns (optional, will auto-place if not provided)
  - `y`: Y position in grid rows (optional, will auto-place if not provided)
  - `content`: React element to render
  - `meta`: Optional metadata object associated with the widget
  - `allowedSizes`: Optional array of allowed size combinations
  - `allowResize`: Whether the widget can be resized (default: true)
  - `allowMove`: Whether the widget can be moved (default: true)

**Example:**

```tsx
gridRef.current?.addWidget({
  id: "new-widget-1",
  w: 2,
  h: 2,
  meta: {
    title: "New Widget",
    type: "chart",
  },
  content: (
    <div className="h-full rounded-md bg-f1-background-secondary p-4">
      New Widget Content
    </div>
  ),
})
```

#### `removeWidget`

Removes a widget from the grid by its ID.

**Parameters:**

- `id`: The unique identifier of the widget to remove (string)

**Example:**

```tsx
gridRef.current?.removeWidget("widget-1")
```

#### `addSubGrid`

Adds a nested grid (sub-grid) to the main grid. This is useful for creating hierarchical layouts
where widgets can be grouped within a parent widget.

**Parameters:**

- `subGrid`: A `GridStackReactWidget` with additional `subGridOpts` property containing:
  - `children`: Array of widgets that will be placed inside the sub-grid

**Example:**

```tsx
gridRef.current?.addSubGrid({
  id: "subgrid-1",
  w: 4,
  h: 4,
  subGridOpts: {
    column: 6,
    children: [
      {
        id: "nested-widget-1",
        w: 2,
        h: 2,
        content: <div>Nested Widget 1</div>,
      },
      {
        id: "nested-widget-2",
        w: 2,
        h: 2,
        content: <div>Nested Widget 2</div>,
      },
    ],
  },
  content: <div>Sub-grid Container</div>,
})
```

#### `removeAll`

Removes all widgets from the grid at once.

**Example:**

```tsx
gridRef.current?.removeAll()
```

### Complete Example

The following example demonstrates all ref methods in action:

<Canvas of={GridStackStories.WithRefMethods} />

This example shows:

- **Add Widget**: Dynamically adds new widgets to the grid
- **Remove Last Widget**: Removes the most recently added widget
- **Remove All**: Clears all widgets from the grid

## Best Practices

1. **Widget IDs**: Always use unique, stable IDs for widgets to ensure proper tracking and removal
2. **Layout Persistence**: Use the `onChange` callback to save widget positions and restore them on
   component mount
3. **Performance**: For large numbers of widgets, consider debouncing the `onChange` callback
4. **Responsive Design**: Configure appropriate column counts for different screen sizes using the
   `options.column` property
5. **Widget Constraints**: Use `allowedSizes` to restrict widget dimensions to specific size
   combinations
6. **Metadata**: Store widget-specific data in the `meta` property for easy retrieval and
   persistence

## Props

### `options`

Configuration object for the grid layout.

- `column`: Number of columns in the grid (default: 12)
- `row`: Number of rows in the grid (optional)
- `margin`: Margin between widgets in pixels (optional)
- `draggable`: Whether widgets can be dragged (default: true)
- `acceptWidgets`: Whether the grid can accept widgets from other grids (default: false)

### `widgets`

Array of initial widgets to render in the grid. Each widget follows the `GridStackReactWidget`
interface.

### `onChange`

Callback function that is called whenever the layout changes (widget moved, resized, added, or
removed). Receives an array of `GridStackWidgetPosition` objects containing the current state of all
widgets.
