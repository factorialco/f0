import { Canvas, Controls, Meta, Source } from "@storybook/addon-docs/blocks"

import * as WithDataTestIdStories from "./withDataTestId.stories"

<Meta of={WithDataTestIdStories} />

# withDataTestId

`withDataTestId` is a Higher-Order Component (HOC) utility that wraps React components to automatically add `data-testid` attributes. This allows consumers to set test IDs at runtime, which is particularly useful for end-to-end testing.

## Usage

Wrap your component with `withDataTestId` before exporting it.

```tsx
import { withDataTestId } from "@f0/react"

const MyComponent = ({ children, ...props }) => <div {...props}>{children}</div>

export const MyComponentWithTestId = withDataTestId(MyComponent)
```

Then use it in your application:

```tsx
<MyComponentWithTestId dataTestId="my-component-123">
  Content
</MyComponentWithTestId>
```

This will render (the HOC uses a wrapper with `display: contents` so the test id is always in the DOM, even if the component does not spread `...rest`):

```html
<div data-testid="my-component-123" style="display: contents">
  <div>Content</div>
</div>
```

## Examples

### Basic Usage

<Canvas of={WithDataTestIdStories.Default} />
<Controls of={WithDataTestIdStories.Default} />

### With Custom Components

<Canvas of={WithDataTestIdStories.CustomComponent} />

## API

The HOC adds a single prop to the wrapped component:

| Prop         | Type     | Description                                |
| :----------- | :------- | :----------------------------------------- |
| `dataTestId` | `string` | The value for the `data-testid` attribute. |

## Features

- **Wrapper fallback**: When `dataTestId` is set, the HOC renders the component inside a wrapper `<div data-testid={...} style={{ display: "contents" }}>`. The attribute is therefore always present in the DOM even if the component forgets to spread `...rest` onto its root element. `display: contents` keeps the wrapper from affecting layout.
- **ForwardRef Support**: Correctly forwards refs to the wrapped component.
- **Static Properties**: Preserves static properties (like `displayName`) of the original component.
- **Memoization**: For memoized components, wrap with `withDataTestId` first, then `memo`: `memo(withDataTestId(Component))`. Using `withDataTestId(memo(Component))` can let `dataTestId` reach the DOM as `datatestid` in some cases.
- **Type Safety**: Preserves the original component's props types using TypeScript generics.
